<div class="flex flex-col h-full">
    <!-- Breadcrumbs & Heading -->
    <div class="flex flex-col gap-4 mb-6">
        <div class="flex items-center gap-2 text-sm text-[#617289] dark:text-gray-400">
            <a class="hover:text-primary transition-colors" href="#">Inicio</a>
            <span class="material-symbols-outlined text-base">chevron_right</span>
            <a class="hover:text-primary transition-colors" href="#">Configuración</a>
            <span class="material-symbols-outlined text-base">chevron_right</span>
            <span class="text-[#111418] dark:text-white font-medium">Catálogo de Servicios</span>
        </div>
        <div class="flex flex-wrap justify-between items-end gap-4">
            <div class="flex flex-col gap-2">
                <h1 class="text-3xl md:text-4xl font-black text-[#111418] dark:text-white tracking-tight">Catálogo de
                    Servicios</h1>
                <p class="text-[#617289] dark:text-gray-400 text-base max-w-xl">Administra especialidades, categorías y
                    servicios de tus tratamientos.</p>
            </div>
            <div class="flex gap-3">
                <button
                    class="flex items-center gap-2 px-4 h-10 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-[#111418] dark:text-white text-sm font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                    <span class="material-symbols-outlined text-[20px]">file_download</span>
                    <span class="hidden sm:inline">Exportar</span>
                </button>
                <button routerLink="/admin/catalog/new"
                    class="flex items-center gap-2 px-4 h-10 rounded-lg bg-primary text-white text-sm font-bold hover:bg-primary/90 transition-colors shadow-sm shadow-primary/30">
                    <span class="material-symbols-outlined text-[20px]">add</span>
                    <span>Nuevo Servicio</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="flex flex-col gap-4 mt-4 h-full min-h-0">
        <!-- Search and Filter Bar -->
        <div class="flex flex-col md:flex-row items-center gap-4">
            <label class="flex flex-col h-10 w-full md:flex-1">
                <div class="flex w-full flex-1 items-stretch rounded-lg h-full bg-[#f0f4f4] dark:bg-gray-800">
                    <div
                        class="text-[#618389] dark:text-gray-400 flex border-none items-center justify-center pl-4 rounded-l-lg border-r-0">
                        <span class="material-symbols-outlined">search</span>
                    </div>
                    <input
                        class="flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] dark:text-white focus:outline-none bg-transparent h-full placeholder:text-[#618389] dark:placeholder:text-gray-500 px-4 rounded-l-none border-none pl-2 text-sm font-normal"
                        placeholder="Buscar por código o nombre del servicio..." type="text" />
                </div>
            </label>
            <div class="flex gap-3 w-full md:w-auto">
                <div class="relative h-10 w-full md:w-48">
                    <select
                        class="h-full w-full appearance-none rounded-lg bg-[#f0f4f4] dark:bg-gray-800 text-[#111418] dark:text-white px-4 pr-8 text-sm focus:outline-none focus:ring-1 focus:ring-primary border-none cursor-pointer">
                        <option>Todos los Tipos</option>
                        <option>Consultorio</option>
                        <option>Laboratorio</option>
                        <option>Tercerizado</option>
                    </select>
                    <div
                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-[#617289] dark:text-gray-400">
                        <span class="material-symbols-outlined">expand_more</span>
                    </div>
                </div>

                <!-- Filter Dropdown -->
                <div class="relative">
                    <button (click)="filtersOpen = !filtersOpen"
                        class="flex items-center gap-2 px-4 h-10 rounded-lg bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark text-[#111418] dark:text-white text-sm font-bold hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors">
                        <span class="material-symbols-outlined text-[20px]">filter_alt</span>
                        <span>Filtros</span>
                        <span class="material-symbols-outlined text-[20px] transition-transform"
                            [class.rotate-180]="filtersOpen">expand_more</span>
                    </button>

                    <!-- Dropdown Content -->
                    <div *ngIf="filtersOpen"
                        class="absolute right-0 mt-2 w-72 origin-top-right rounded-lg shadow-lg bg-white dark:bg-surface-dark ring-1 ring-black ring-opacity-5 focus:outline-none z-10 p-4 border border-border-light dark:border-border-dark">
                        <h3 class="text-[#111418] dark:text-white text-lg font-bold mb-3">Filtrar por Área y Categoría
                        </h3>
                        <div class="flex flex-col gap-4">
                            <!-- Mock Area Filter -->
                            <div>
                                <label
                                    class="block text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wide mb-1">Área
                                    / Especialidad</label>
                                <div class="relative">
                                    <select
                                        class="block w-full appearance-none rounded-lg bg-[#f0f4f4] dark:bg-gray-800 text-[#111418] dark:text-white px-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary border-none cursor-pointer">
                                        <option selected>Ortodoncia</option>
                                        <option>Operatoria Dental</option>
                                        <option>Periodoncia</option>
                                        <option>Endodoncia</option>
                                        <option>Cirugía Oral</option>
                                        <option>Odontopediatría</option>
                                    </select>
                                    <div
                                        class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-[#617289] dark:text-gray-400">
                                        <span class="material-symbols-outlined">expand_more</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Categories Filter List -->
                            <div>
                                <label
                                    class="block text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wide mb-1">Categorías</label>
                                <nav class="flex flex-col gap-1 max-h-48 overflow-y-auto custom-scrollbar">
                                    <button (click)="filterByCategory(null)"
                                        class="flex items-center px-3 py-2 rounded-lg font-bold border-l-4 transition-all text-left"
                                        [class.bg-primary-10]="!selectedCategory"
                                        [class.text-primary]="!selectedCategory"
                                        [class.border-primary]="!selectedCategory"
                                        [class.text-text-secondary]="selectedCategory"
                                        [class.hover:bg-gray-50]="selectedCategory"
                                        [class.dark:text-gray-400]="selectedCategory"
                                        [class.dark:hover:bg-gray-800]="selectedCategory"
                                        [class.border-transparent]="selectedCategory">
                                        <span>Todas las Categorías</span>
                                    </button>

                                    <button *ngFor="let cat of categories" (click)="filterByCategory(cat)"
                                        class="flex items-center px-3 py-2 rounded-lg font-medium transition-all text-left border-l-4"
                                        [class.bg-primary-10]="selectedCategory?.id === cat.id"
                                        [class.text-primary]="selectedCategory?.id === cat.id"
                                        [class.border-primary]="selectedCategory?.id === cat.id"
                                        [class.text-text-secondary]="selectedCategory?.id !== cat.id"
                                        [class.hover:bg-gray-50]="selectedCategory?.id !== cat.id"
                                        [class.dark:text-gray-400]="selectedCategory?.id !== cat.id"
                                        [class.dark:hover:bg-gray-800]="selectedCategory?.id !== cat.id"
                                        [class.border-transparent]="selectedCategory?.id !== cat.id">
                                        <span>{{cat.name}}</span>
                                    </button>
                                </nav>
                            </div>

                            <div
                                class="bg-primary/5 dark:bg-primary/10 rounded-lg p-3 border border-primary/20 flex flex-col gap-2">
                                <div class="flex items-center gap-2 text-primary font-bold">
                                    <span class="material-symbols-outlined text-[18px]">info</span>
                                    <span class="text-xs">Administración</span>
                                </div>
                                <p class="text-xs text-[#617289] dark:text-gray-400">Las Áreas y Categorías se gestionan
                                    en la sección de <a routerLink="/configuration"
                                        class="text-primary hover:underline">Configuración</a>.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Backdrop for closing -->
                    <div *ngIf="filtersOpen" (click)="filtersOpen = false" class="fixed inset-0 z-0 cursor-default">
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div
            class="bg-white dark:bg-surface-dark rounded-xl shadow-sm border border-border-light dark:border-border-dark overflow-hidden flex flex-col flex-1">
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead>
                        <tr class="bg-gray-50 dark:bg-gray-800/50 border-b border-border-light dark:border-border-dark">
                            <th
                                class="p-4 text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wider w-24">
                                Código</th>
                            <th
                                class="p-4 text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wider">
                                Descripción</th>
                            <th
                                class="p-4 text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wider w-32">
                                Tipo</th>
                            <th
                                class="p-4 text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wider text-right w-32">
                                Precio</th>
                            <th
                                class="p-4 text-xs font-bold text-[#617289] dark:text-gray-400 uppercase tracking-wider w-20 text-center">
                                Acciones</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-50 dark:divide-gray-800">
                        <tr *ngFor="let service of filteredServices"
                            class="group hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors">
                            <td class="p-4 text-sm font-medium text-[#617289] dark:text-gray-400">{{service.code}}</td>
                            <td class="p-4 text-sm font-bold text-[#111418] dark:text-white">
                                {{service.name}}
                                <span
                                    class="block text-xs font-normal text-[#617289] dark:text-gray-500 mt-0.5">{{service.description}}</span>
                            </td>
                            <td class="p-4">
                                <span
                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300">
                                    {{service.type || 'Consultorio'}}
                                </span>
                            </td>
                            <td class="p-4 text-sm font-bold text-[#111418] dark:text-white text-right">{{service.price
                                | currency}}</td>
                            <td class="p-4 text-center">
                                <div
                                    class="flex justify-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <button [routerLink]="['/admin/catalog/edit', service.id]"
                                        class="text-[#617289] hover:text-primary transition-colors" title="Editar">
                                        <span class="material-symbols-outlined text-[20px]">edit</span>
                                    </button>
                                    <button (click)="deleteService(service)"
                                        class="text-[#617289] hover:text-red-500 transition-colors" title="Eliminar">
                                        <span class="material-symbols-outlined text-[20px]">delete</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <tr *ngIf="filteredServices.length === 0">
                            <td colspan="5" class="p-8 text-center text-gray-500">
                                No se encontraron servicios con los filtros actuales.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination -->
            <div
                class="p-4 border-t border-border-light dark:border-border-dark flex items-center justify-between mt-auto">
                <p class="text-sm text-[#617289] dark:text-gray-400">
                    Mostrando <span class="font-bold text-[#111418] dark:text-white">1</span> a <span
                        class="font-bold text-[#111418] dark:text-white">{{filteredServices.length}}</span> de <span
                        class="font-bold text-[#111418] dark:text-white">{{services.length}}</span> servicios
                </p>
                <div class="flex gap-2">
                    <button
                        class="size-8 flex items-center justify-center rounded-lg border border-gray-200 dark:border-gray-700 text-[#617289] dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800 disabled:opacity-50">
                        <span class="material-symbols-outlined text-sm">chevron_left</span>
                    </button>
                    <button
                        class="size-8 flex items-center justify-center rounded-lg bg-primary text-white text-sm font-bold">1</button>
                    <button
                        class="size-8 flex items-center justify-center rounded-lg border border-gray-200 dark:border-gray-700 text-[#617289] dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800">2</button>
                    <button
                        class="size-8 flex items-center justify-center rounded-lg border border-gray-200 dark:border-gray-700 text-[#617289] dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-800">
                        <span class="material-symbols-outlined text-sm">chevron_right</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>