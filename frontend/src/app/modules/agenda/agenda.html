<div class="flex flex-col h-full bg-background-light dark:bg-background-dark p-6 gap-6">

    <!-- Top Toolbar / Header -->
    <header
        class="bg-surface-light dark:bg-surface-dark border-b border-border-light dark:border-border-dark px-6 py-4 flex flex-col gap-4 shadow-sm z-10 rounded-t-xl">
        <!-- Row 1: Title and Main Action -->
        <div class="flex justify-between items-center">
            <div>
                <h2 class="text-2xl font-bold text-slate-900 dark:text-white tracking-tight">Agenda de Citas</h2>
                <p class="text-sm text-slate-500 dark:text-slate-400">Gestione horarios y disponibilidad del consultorio
                </p>
            </div>
            <button
                class="bg-primary hover:bg-primary-hover text-white px-5 py-2.5 rounded-lg font-bold text-sm shadow-lg shadow-primary/20 flex items-center gap-2 transition-all active:scale-95"
                (click)="openNewAppointmentDialog()">
                <span class="material-symbols-outlined text-[20px]">add</span>
                Nueva Cita
            </button>
        </div>

        <!-- Row 2: Filters and Navigation -->
        <div class="flex flex-wrap items-center justify-between gap-4 mt-2">
            <!-- Left: Date Navigation -->
            <div class="flex items-center bg-slate-100 dark:bg-slate-800 rounded-lg p-1">
                <button
                    class="p-1.5 hover:bg-white dark:hover:bg-slate-700 rounded-md text-slate-600 dark:text-slate-300 transition-colors"
                    (click)="previousWeek()">
                    <span class="material-symbols-outlined text-sm">chevron_left</span>
                </button>
                <span class="px-4 text-sm font-semibold text-slate-900 dark:text-white min-w-[140px] text-center">{{
                    currentDate | date:'MMMM yyyy' | titlecase }}</span>
                <button
                    class="p-1.5 hover:bg-white dark:hover:bg-slate-700 rounded-md text-slate-600 dark:text-slate-300 transition-colors"
                    (click)="nextWeek()">
                    <span class="material-symbols-outlined text-sm">chevron_right</span>
                </button>
                <button
                    class="ml-2 px-3 py-1 text-xs font-medium text-primary bg-primary/10 rounded hover:bg-primary/20 transition-colors"
                    (click)="goToToday()">Hoy</button>
            </div>

            <!-- Middle: View Switcher -->
            <div class="bg-slate-100 dark:bg-slate-800 rounded-lg p-1 flex">
                <label class="cursor-pointer relative">
                    <input type="radio" name="view" value="day" class="peer sr-only" [checked]="view === 'day'"
                        (change)="view = 'day'">
                    <div
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-slate-500 dark:text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-slate-900 dark:peer-checked:text-white peer-checked:shadow-sm transition-all">
                        DÃ­a</div>
                </label>
                <label class="cursor-pointer relative">
                    <input type="radio" name="view" value="week" class="peer sr-only" [checked]="view === 'week'"
                        (change)="view = 'week'">
                    <div
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-slate-500 dark:text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-slate-900 dark:peer-checked:text-white peer-checked:shadow-sm transition-all">
                        Semana</div>
                </label>
                <label class="cursor-pointer relative">
                    <input type="radio" name="view" value="month" class="peer sr-only" [checked]="view === 'month'"
                        (change)="view = 'month'">
                    <div
                        class="px-4 py-1.5 rounded-md text-sm font-medium text-slate-500 dark:text-slate-400 peer-checked:bg-white dark:peer-checked:bg-slate-700 peer-checked:text-slate-900 dark:peer-checked:text-white peer-checked:shadow-sm transition-all">
                        Mes</div>
                </label>
            </div>

            <!-- Right: Filters -->
            <div class="flex items-center gap-3 flex-1 justify-end">
                <!-- Professional Select -->
                <div class="relative w-48">
                    <select [(ngModel)]="selectedDentistId"
                        class="w-full appearance-none bg-slate-100 dark:bg-slate-800 border-none rounded-lg text-sm text-slate-900 dark:text-white py-2.5 pl-3 pr-8 focus:ring-2 focus:ring-primary/50 cursor-pointer outline-none">
                        <option value="">Todos los Doctores</option>
                        <option *ngFor="let dentist of dentists" [value]="dentist.id">Dr. {{ dentist.name }}</option>
                    </select>
                    <span
                        class="material-symbols-outlined absolute right-2 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none text-[20px]">arrow_drop_down</span>
                </div>
                <!-- Search -->
                <div class="relative w-64">
                    <span
                        class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-[20px]">search</span>
                    <input type="text" placeholder="Buscar paciente..." [(ngModel)]="searchTerm"
                        class="w-full bg-slate-100 dark:bg-slate-800 border-none rounded-lg text-sm text-slate-900 dark:text-white py-2.5 pl-10 focus:ring-2 focus:ring-primary/50 placeholder-slate-400 dark:placeholder-slate-500 outline-none">
                </div>
            </div>
        </div>
    </header>

    <!-- Calendar View -->
    <div class="flex-1 min-h-0">
        <app-calendar-view [currentDate]="currentDate" [view]="view" [appointments]="filteredAppointments"
            (slotClick)="onSlotClick($event)" (appointmentClick)="onAppointmentClick($event)"
            (changeView)="onChangeView($event)">
        </app-calendar-view>
    </div>

    <app-appointment-dialog [isOpen]="isDialogOpen" [date]="selectedDateStr" [startTime]="selectedTimeStr"
        [appointment]="selectedAppointment" (closeDialog)="isDialogOpen = false"
        (saveAppointment)="onSaveAppointment($event)" (deleteAppointment)="onDeleteAppointment($event)">
    </app-appointment-dialog>

</div>