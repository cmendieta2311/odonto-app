<div class="container">
    <!-- Breadcrumbs -->
    <div class="flex flex-wrap gap-2 text-sm">
        <a class="text-text-secondary-light dark:text-text-secondary-dark hover:text-primary transition-colors"
            routerLink="/">Inicio</a>
        <span class="text-text-secondary-light dark:text-text-secondary-dark">/</span>
        <span class="text-text-main-light dark:text-text-main-dark font-medium">Pacientes</span>
    </div>

    <!-- Page Heading & Main Action -->
    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl md:text-4xl font-black text-text-main-light dark:text-text-main-dark tracking-tight">
                Gestión de Pacientes</h1>
            <p class="text-text-secondary-light dark:text-text-secondary-dark mt-1">Administra historias clínicas,
                presupuestos y financiaciones.</p>
        </div>
        <button title="Alt + N"
            class="flex items-center gap-2 bg-primary hover:bg-primary-hover text-white px-5 py-2.5 rounded-lg font-bold shadow-lg shadow-primary/20 transition-all active:scale-95"
            (click)="createPatient()">
            <span class="material-symbols-outlined" style="font-size: 20px;">add</span>
            Nuevo Paciente <span
                class="text-[10px] opacity-80 font-normal ml-1 border border-white/30 rounded px-1 hidden md:inline-block">Alt+N</span>
        </button>
    </div>

    <!-- Stats Cards -->
    <!-- <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <app-stat-card label="Total Pacientes" [value]="patients.length" icon="groups" variant="primary"
            trendLabel="+2.5% este mes" trendIcon="trending_up"></app-stat-card>
        <app-stat-card label="Con Deuda" value="45" icon="money_off" variant="red"
            trendLabel="Acción requerida"></app-stat-card>
        <app-stat-card label="Tratamientos Activos" value="128" icon="dentistry" variant="blue"
            trendLabel="En curso"></app-stat-card>
        <app-stat-card label="Nuevos (Mes)" value="+32" icon="person_add" variant="purple"
            trendLabel="+12% vs mes anterior" trendIcon="trending_up"></app-stat-card>
    </div> -->

    <!-- Filter & Search Section -->
    <div
        class="bg-surface-light dark:bg-surface-dark p-4 rounded-xl border border-[#dbe4e6] dark:border-[#2a3e42] shadow-sm">
        <div class="flex flex-col md:flex-row gap-4 justify-between items-center">
            <div class="relative flex-1 w-full md:max-w-md">
                <span
                    class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-secondary-light dark:text-text-secondary-dark"
                    style="font-size: 20px;">search</span>
                <input [formControl]="searchControl"
                    class="w-full h-11 pl-10 pr-4 rounded-lg bg-background-light dark:bg-background-dark border border-[#dbe4e6] dark:border-[#2a3e42] text-sm focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
                    placeholder="Buscar por nombre, N° documento..." type="text" />
            </div>
            <!-- Disabled filters for now as backend only supports search. Can be re-enabled later if needed -->
            <!-- <div class="flex w-full md:w-auto gap-3 overflow-x-auto pb-1 md:pb-0">
                ... 
            </div> -->
        </div>
    </div>

    <!-- Patients Table -->
    <app-custom-table [columns]="columns" [data]="data" [totalItems]="totalItems" [page]="page" [pageSize]="pageSize"
        [showEdit]="true" [showDelete]="true" [showPagination]="true" [isLoading]="isLoading"
        (pageChange)="onPageChange($event)" (pageSizeChange)="onPageSizeChange($event)" (onEdit)="editPatient($event)"
        (onDelete)="deletePatient($event)" [columnTemplates]="{ patient: patientTmpl, contact: contactTmpl }">
    </app-custom-table>

    <!-- Templates for Custom Table -->
    <ng-template #patientTmpl let-patient>
        <div class="flex items-center gap-3 cursor-pointer group" (click)="viewPatient(patient)">
            <div
                class="size-10 rounded-full bg-primary/10 text-primary font-bold flex items-center justify-center shrink-0 group-hover:bg-primary group-hover:text-white transition-colors">
                {{patient.firstName[0]}}{{patient.lastName[0]}}
            </div>
            <div class="flex flex-col">
                <span
                    class="text-sm font-bold text-text-main-light dark:text-text-main-dark group-hover:text-primary transition-colors">{{patient.firstName}}
                    {{patient.lastName}}</span>
                <span class="text-xs text-text-secondary-light dark:text-text-secondary-dark">{{patient.dni}}</span>
            </div>
        </div>
    </ng-template>

    <ng-template #contactTmpl let-patient>
        <div class="flex flex-col text-sm">
            <span class="text-text-main-light dark:text-text-main-dark">{{patient.phone}}</span>
            <span class="text-xs text-text-secondary-light dark:text-text-secondary-dark">{{patient.email}}</span>
        </div>
    </ng-template>
</div>